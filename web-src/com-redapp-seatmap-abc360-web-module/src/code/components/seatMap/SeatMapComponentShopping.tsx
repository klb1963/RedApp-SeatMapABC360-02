// file: SeatMapComponentShopping.tsx

import * as React from 'react';
import { useState } from 'react';
import SeatMapComponentBase from './SeatMapComponentBase';
import { generateFlightData } from '../../utils/generateFlightData';
import SeatLegend from './SeatLegend';

interface SeatMapComponentShoppingProps {
  config: any;
  data: any;
}

const SeatMapComponentShopping: React.FC<SeatMapComponentShoppingProps> = ({ config, data }) => {
  const flightSegments = Array.isArray(data?.flightSegments) ? data.flightSegments : [];

  const [cabinClass, setCabinClass] = useState<'Y' | 'S' | 'C' | 'F' | 'A'>('Y');
  const [segmentIndex, setSegmentIndex] = useState(0);

  const currentSegment = flightSegments[segmentIndex] || {};

  // –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–π EncodeDecodeElement)
  const equipment =
    typeof currentSegment.equipment === 'object'
      ? currentSegment.equipment?.EncodeDecodeElement?.SimplyDecoded
      : currentSegment.equipment || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

  return (
    <div style={{ padding: '1rem' }}>
      {/* üîÅ –°–µ–ª–µ–∫—Ç–æ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–∞–º–æ–ª—ë—Ç–∞ */}
      <div
        style={{
          display: 'flex',
          alignItems: 'center',
          flexWrap: 'wrap',
          gap: '1rem',
          marginBottom: '1rem',
        }}
      >
        <div>
          <label style={{ marginRight: '0.5rem' }}>–°–µ–≥–º–µ–Ω—Ç:</label>
          <select
            value={segmentIndex}
            onChange={(e) => setSegmentIndex(Number(e.target.value))}
          >
            {flightSegments.map((seg: any, idx: number) => (
              <option key={idx} value={idx}>
                {seg.origin || '???'} ‚Üí {seg.destination || '???'}, —Ä–µ–π—Å {seg.flightNumber || '---'}
              </option>
            ))}
          </select>
        </div>

        <div style={{ fontSize: '1.5rem', color: '#555' }}>
          ‚úàÔ∏è <strong>–°–∞–º–æ–ª—ë—Ç:</strong> {equipment}
        </div>
      </div>

      {/* üëî –ö–ª–∞—Å—Å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è */}
      <div style={{ marginBottom: '1rem' }}>
        <label style={{ marginRight: '0.5rem' }}>–ö–ª–∞—Å—Å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:</label>
        <select
          value={cabinClass}
          onChange={(e) => setCabinClass(e.target.value as 'Y' | 'S' | 'C' | 'F' | 'A')}
        >
          <option value="Y">Economy</option>
          <option value="S">Premium Economy</option>
          <option value="C">Business</option>
          <option value="F">First</option>
          <option value="A">All Cabins</option>
        </select>
      </div>

      {/* üß© –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –º–µ—Å—Ç */}
      <SeatMapComponentBase
        config={config}
        flightSegments={flightSegments}
        initialSegmentIndex={segmentIndex}
        cabinClass={cabinClass}
        generateFlightData={(segment, index, cabin) =>
          generateFlightData(
            {
              ...segment,
              cabinClass: cabin,
              equipment: segment.equipment,
            },
            index
          )
        }
        availability={[]}
        passengers={[]} 
        showSegmentSelector={false}
        flightInfo={
          <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
            <div>
              <strong>Flight info:</strong>
              <div>{currentSegment.origin} ‚Üí {currentSegment.destination}</div>
              <div>Date: {currentSegment.departureDateTime || 'not specified'}</div>
              <div>Equipment: {currentSegment.equipment?.EncodeDecodeElement?.SimplyDecoded || 'Unknown'}</div>
              <div>Class: {cabinClass}</div>
            </div>
            <SeatLegend />
          </div>
        }
      />
    </div>
  );
};

export default SeatMapComponentShopping;